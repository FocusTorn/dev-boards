#!/usr/bin/env python3
"""
Cross-platform installer script for pyprompt package.
Installs using UV if available, otherwise falls back to pip.
"""

import sys
import os
import subprocess
from pathlib import Path

def check_command(cmd):
    """Check if a command is available."""
    try:
        subprocess.run([cmd, "--version"], capture_output=True, check=True)
        return True
    except (subprocess.CalledProcessError, FileNotFoundError):
        return False

def install_with_uv(package_path):
    """Install package using UV."""
    print("Installing with UV...")
    try:
        # UV uses 'uv pip install' for editable installs
        result = subprocess.run(
            ["uv", "pip", "install", "-e", str(package_path)],
            check=True
        )
        print("✓ Successfully installed with UV")
        return True
    except subprocess.CalledProcessError as e:
        print(f"✗ UV installation failed: {e}", file=sys.stderr)
        return False

def install_with_pip(package_path):
    """Install package using pip."""
    print("Installing with pip...")
    try:
        result = subprocess.run(
            [sys.executable, "-m", "pip", "install", "-e", str(package_path)],
            check=True
        )
        print("✓ Successfully installed with pip")
        return True
    except subprocess.CalledProcessError as e:
        print(f"✗ pip installation failed: {e}", file=sys.stderr)
        return False

def main():
    """Main installation function."""
    # Get the directory where this script is located
    script_dir = Path(__file__).parent.resolve()
    package_path = script_dir
    
    # Check if pyproject.toml exists
    if not (package_path / "pyproject.toml").exists():
        print(f"Error: pyproject.toml not found in {package_path}", file=sys.stderr)
        print("Make sure you're running this script from the package directory.", file=sys.stderr)
        return 1
    
    print(f"Installing pyprompt from: {package_path}")
    print()
    
    # Check for UV first
    if check_command("uv"):
        print("UV detected, using UV for installation...")
        if install_with_uv(package_path):
            return 0
        print("\nUV installation failed, falling back to pip...")
        print()
    
    # Fall back to pip
    if check_command("pip") or True:  # pip should always be available with Python
        print("Using pip for installation...")
        if install_with_pip(package_path):
            return 0
    
    print("Error: Installation failed with both UV and pip", file=sys.stderr)
    return 1

if __name__ == "__main__":
    sys.exit(main())

