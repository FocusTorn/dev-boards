---
alwaysApply: true
---
# Workspace Rules

## **CRITICAL EXECUTION DIRECTIVE**

**AI Agent Directive**: Follow workspace rules exactly for all file handling and rule application tasks.

**MANDATORY EXECUTION PROTOCOL**:

1. **NO DEVIATION**: All workspace rules must be followed exactly as written
2. **NO SKIPPING**: No steps may be skipped, abbreviated, or modified
3. **NO SELECTIVE COMPLIANCE**: All rules apply to all workspace activities
4. **FAILURE TO COMPLY**: Violating these rules constitutes a critical protocol violation

## **EXTENSIONLESS FILE HANDLING**

### **1. :: Syntax-Based Rule Application**

**✅ CORRECT - Treat extensionless files based on syntax**:

When working with a file that has no extension, the AI must:

1. **Detect File Syntax**: Analyze the file content to determine the programming language or file type
2. **Apply Corresponding Rules**: Treat the file as though it has the appropriate extension and apply all relevant rules
3. **Language-Specific Rules**: Apply all rules from `.cursor/rules/by-language/[detected-language]/` as if the file had the correct extension
4. **Formatting Rules**: Apply formatting rules appropriate to the detected syntax
5. **Code Quality Rules**: Apply code quality rules for the detected language

**✅ CORRECT - Example: Extensionless Python file**:

```python
#!/usr/bin/env python3
"""Extensionless file containing Python code."""

def example_function():
    """This file has no .py extension but contains Python code."""
    return True
```

**AI Behavior**: 
- Detect Python syntax from shebang (`#!/usr/bin/env python3`) and code structure
- Apply all `.cursor/rules/by-language/python/*.mdc` rules
- Apply Python formatting rules
- Apply Python code quality rules
- Treat as if file extension is `.py`

**✅ CORRECT - Example: Extensionless shell script**:

```bash
#!/bin/bash
# Extensionless bash script
echo "Hello World"
```

**AI Behavior**:
- Detect shell script syntax from shebang (`#!/bin/bash`)
- Apply shell script formatting rules
- Treat as if file extension is `.sh` or `.bash`

**✅ CORRECT - Example: Extensionless JavaScript/TypeScript**:

```javascript
// Extensionless JavaScript file
function example() {
    return true;
}
```

**AI Behavior**:
- Detect JavaScript/TypeScript syntax from code structure
- Apply all `.cursor/rules/by-language/javascript/*.mdc` or `.cursor/rules/by-language/typescript/*.mdc` rules
- Treat as if file extension is `.js` or `.ts`

**❌ INCORRECT - Ignoring extensionless files**:

```python
# Wrong: Not applying Python rules to extensionless Python file
# File: sync (no extension, but contains Python code)
# AI ignores Python rules because file has no .py extension
```

**❌ INCORRECT - Applying wrong language rules**:

```python
# Wrong: Applying JavaScript rules to extensionless Python file
# File: sync (no extension, contains Python code)
# AI incorrectly applies JavaScript rules
```

### **2. :: Detection Methods**

**✅ CORRECT - Syntax detection priority**:

1. **Shebang Line**: Check for shebang (`#!/usr/bin/env python3`, `#!/bin/bash`, etc.)
2. **File Content**: Analyze code structure, keywords, and syntax patterns
3. **File Location**: Consider directory context (e.g., `scripts/` directory often contains scripts)
4. **File Name Patterns**: Consider common naming patterns (e.g., `sync`, `build`, `test`)

**✅ CORRECT - Multi-language detection**:

```python
#!/usr/bin/env python3
"""File may contain multiple languages."""
# Python code here
```

```bash
# Shell script embedded
echo "Shell commands"
```

**AI Behavior**: 
- Primary language: Python (from shebang)
- Apply Python rules primarily
- Recognize embedded shell commands and apply appropriate handling

**❌ INCORRECT - Single detection method**:

```python
# Wrong: Only checking file extension
# If no extension, skip all rules

# Wrong: Only checking shebang
# If no shebang, skip all rules
```

### **3. :: Rule Application**

**✅ CORRECT - Complete rule application**:

When an extensionless file is detected as a specific language:

1. **Language-Specific Rules**: Apply all rules from `.cursor/rules/by-language/[language]/`
2. **Formatting Rules**: Apply formatting rules for the detected language
3. **Code Quality Rules**: Apply code quality rules for the detected language
4. **Tool-Specific Rules**: Apply tool-specific rules if applicable (e.g., UV for Python)
5. **Project-Specific Rules**: Apply project-specific rules if applicable

**✅ CORRECT - Example: Extensionless Python script**:

```
File: D:\_dev\projects\dev-boards\___shared\.sync-manager\scripts\sync
Content: Python code
```

**Applied Rules**:
- `.cursor/rules/by-language/python/code-organization.mdc`
- `.cursor/rules/by-language/python/code-structure.mdc`
- `.cursor/rules/formatting/terminal-output.mdc` (if applicable)
- `.cursor/rules/tool/uv/workspace.mdc` (if using UV)
- All other Python-specific rules

**❌ INCORRECT - Partial rule application**:

```python
# Wrong: Only applying some rules
# File: sync (extensionless Python)
# AI only applies code-organization.mdc but ignores code-structure.mdc
```

**❌ INCORRECT - No rule application**:

```python
# Wrong: Not applying any rules
# File: sync (extensionless Python)
# AI treats as plain text, no rules applied
```

## **ENVIRONMENT VARIABLE USAGE**

### **1. :: WORKSPACE_ROOT Environment Variable**

**✅ CORRECT - Use WORKSPACE_ROOT environment variable**:

The `WORKSPACE_ROOT` environment variable must be set to the absolute path of the workspace root directory. This variable is used by scripts and tools to locate workspace resources and shared packages.

**✅ CORRECT - Setting WORKSPACE_ROOT in workspace settings**:

Add `WORKSPACE_ROOT` to your workspace settings file:

**VS Code** (`.vscode/settings.json`):
```json
{
    "WORKSPACE_ROOT": "D:\\_dev\\_Projects\\dev-boards"
}
```

**Cursor** (`.cursor/settings.json`):
```json
{
    "WORKSPACE_ROOT": "D:\\_dev\\_Projects\\dev-boards"
}
```

**✅ CORRECT - Setting WORKSPACE_ROOT as shell environment variable**:

```bash
# Windows (PowerShell)
$env:WORKSPACE_ROOT = "D:\_dev\_Projects\dev-boards"

# Linux/Unix
export WORKSPACE_ROOT="/path/to/dev-boards"
```

**✅ CORRECT - Accessing WORKSPACE_ROOT in Python scripts**:

```python
import os
from pathlib import Path

# Get workspace root from environment variable
root_path = os.environ.get('WORKSPACE_ROOT')
if not root_path:
    print("ERROR: WORKSPACE_ROOT environment variable not set.", file=sys.stderr)
    print()
    print("  Please add WORKSPACE_ROOT to your workspace settings file:")
    print("    .vscode/settings.json (VS Code)")
    print("    .cursor/settings.json (Cursor)")
    sys.exit(1)

_workspace_root = Path(root_path)
```

**❌ INCORRECT - Auto-detecting workspace root as fallback**:

```python
# Wrong: Auto-detecting workspace root when WORKSPACE_ROOT is not set
root_path = os.environ.get('WORKSPACE_ROOT')
if not root_path:
    # Wrong: Don't auto-detect - require explicit configuration
    current = Path(__file__).resolve()
    for parent in current.parents:
        if (parent / "pyproject.toml").exists():
            root_path = str(parent)
            break
```

**❌ INCORRECT - Using relative paths or hardcoded paths**:

```python
# Wrong: Using relative paths
_workspace_root = Path(__file__).parent.parent.parent

# Wrong: Hardcoding paths
_workspace_root = Path("D:/_dev/_Projects/dev-boards")
```

### **2. :: Environment Variable Requirements**

**✅ CORRECT - Scripts must require WORKSPACE_ROOT**:

All scripts that need workspace root access must:

1. **Check for WORKSPACE_ROOT**: Always check if `WORKSPACE_ROOT` environment variable is set
2. **Provide Clear Error**: If not set, display clear error message with instructions
3. **Exit with Error Code**: Exit with non-zero exit code if `WORKSPACE_ROOT` is not set
4. **No Auto-Detection**: Never implement auto-detection as a fallback

**✅ CORRECT - Error message format**:

```python
if not root_path:
    print("ERROR: WORKSPACE_ROOT environment variable not set.", file=sys.stderr)
    print()
    print("  Please add WORKSPACE_ROOT to your workspace settings file:")
    print("    .vscode/settings.json (VS Code)")
    print("    .cursor/settings.json (Cursor)")
    print()
    print("  Add the following setting:")
    print('    "WORKSPACE_ROOT": "D:\\\\_dev\\\\_Projects\\\\dev-boards"')
    print()
    print("  Or set it as an environment variable in your shell.")
    sys.exit(1)
```

**❌ INCORRECT - Auto-detection fallback**:

```python
# Wrong: Implementing auto-detection when WORKSPACE_ROOT is not set
if not root_path:
    # Auto-detect by walking up directory tree
    current = Path(__file__).resolve()
    for parent in current.parents:
        if (parent / "pyproject.toml").exists():
            root_path = str(parent)
            break
```

**❌ INCORRECT - Silent failure or default values**:

```python
# Wrong: Using default value or current directory
root_path = os.environ.get('WORKSPACE_ROOT', os.getcwd())

# Wrong: Continuing without workspace root
if not root_path:
    print("Warning: WORKSPACE_ROOT not set, using current directory")
    root_path = os.getcwd()
```

## **ANTI-PATTERNS**

### **❌ Extensionless File Handling Violations**

- ❌ **Ignoring Extensionless Files** - Don't skip rule application for files without extensions
- ❌ **Wrong Language Detection** - Don't apply incorrect language rules to extensionless files
- ❌ **Partial Rule Application** - Don't apply only some rules to extensionless files
- ❌ **No Syntax Detection** - Don't skip syntax detection for extensionless files
- ❌ **Single Detection Method** - Don't rely on only one method for syntax detection

### **❌ Environment Variable Violations**

- ❌ **Auto-Detection Fallback** - Don't implement auto-detection when WORKSPACE_ROOT is not set
- ❌ **Silent Failure** - Don't continue execution if WORKSPACE_ROOT is not set
- ❌ **Default Values** - Don't use default values or current directory as fallback
- ❌ **Hardcoded Paths** - Don't hardcode workspace root paths in scripts
- ❌ **Relative Paths** - Don't use relative paths to determine workspace root

## **QUALITY GATES**

### **Extensionless File Handling**

- [ ] **Syntax Detection**: File syntax is correctly detected from shebang, content, or context
- [ ] **Rule Application**: All appropriate rules for detected language are applied
- [ ] **Formatting Rules**: Formatting rules for detected language are applied
- [ ] **Code Quality Rules**: Code quality rules for detected language are applied
- [ ] **Complete Coverage**: All relevant rules are applied, not just a subset

### **Environment Variable Usage**

- [ ] **WORKSPACE_ROOT Required**: Scripts check for WORKSPACE_ROOT environment variable
- [ ] **Clear Error Messages**: Error messages provide instructions for setting WORKSPACE_ROOT
- [ ] **No Auto-Detection**: No auto-detection fallback is implemented
- [ ] **Proper Exit Codes**: Scripts exit with non-zero code if WORKSPACE_ROOT is not set
- [ ] **Workspace Settings**: WORKSPACE_ROOT is configured in workspace settings file

## **SUCCESS METRICS**

### **Extensionless File Handling**

After implementing proper extensionless file handling:

- ✅ **Correct Rule Application** - Extensionless files receive appropriate rules based on syntax
- ✅ **Language Detection** - File syntax is correctly identified through multiple methods
- ✅ **Complete Coverage** - All relevant rules are applied to extensionless files
- ✅ **Consistent Behavior** - Extensionless files are treated the same as files with extensions
- ✅ **No Rule Gaps** - No rules are skipped for extensionless files

### **Environment Variable Usage**

After implementing proper environment variable usage:

- ✅ **Explicit Configuration** - WORKSPACE_ROOT is explicitly set in workspace settings
- ✅ **Clear Error Messages** - Users receive clear instructions when WORKSPACE_ROOT is missing
- ✅ **No Auto-Detection** - Scripts require explicit configuration, no fallback detection
- ✅ **Consistent Behavior** - All scripts use the same environment variable for workspace root
- ✅ **Cross-Platform Support** - Workspace root resolution works on Windows, Linux, and Unix

