---
alwaysApply: true
---

# Code Maintenance Rules

## **CRITICAL EXECUTION DIRECTIVE**

**AI Agent Directive**: Follow code maintenance rules exactly for all refactoring and code evolution tasks.

**MANDATORY EXECUTION PROTOCOL**:

1. **NO DEVIATION**: All maintenance rules must be followed exactly as written
2. **NO SKIPPING**: No steps may be skipped, abbreviated, or modified
3. **NO SELECTIVE COMPLIANCE**: All rules apply to all code maintenance activities
4. **FAILURE TO COMPLY**: Violating these rules constitutes a critical protocol violation

## **BACKWARD COMPATIBILITY REMOVAL**

### **1. :: Immediate Removal After Refactoring**

**✅ CORRECT - Remove all backward compatibility code immediately**:

```python
# After refactoring from questionary to prompt_toolkit:
# 1. Remove legacy function aliases
# def confirm_custom(...):  # REMOVE - use confirm() instead
#     return confirm(...)

# 2. Remove compatibility constants
# HAS_TERMINAL_MENU = HAS_PROMPT_TOOLKIT  # REMOVE
# MENU_STYLE = None  # REMOVE

# 3. Update all imports
from ..core.prompts import confirm, HAS_PROMPT_TOOLKIT  # Use new names

# 4. Update all function calls
proceed = confirm("Proceed?", default=True, indent="")  # Use new function name

# 5. Update __init__.py exports
__all__ = ['confirm', 'HAS_PROMPT_TOOLKIT']  # Remove legacy names
```

**❌ INCORRECT - Keeping backward compatibility code**:

```python
# Wrong: Keeping aliases "just in case"
def confirm_custom(...):  # Don't keep this
    return confirm(...)

# Wrong: Keeping compatibility constants
HAS_TERMINAL_MENU = HAS_PROMPT_TOOLKIT  # Don't keep this

# Wrong: Not updating all references
from ..core.prompts import confirm_custom  # Should use confirm
```

### **2. :: Breaking Changes Documentation**

**✅ CORRECT - Document breaking changes in comment block at top of module/package**:

```python
"""
Git-py package for GitHub repository setup and management.

BREAKING CHANGES (v2.0.0):
- confirm_custom() removed → use confirm() instead
- HAS_TERMINAL_MENU removed → use HAS_PROMPT_TOOLKIT instead
- MENU_STYLE removed → no longer needed
- All prompt functions now use prompt_toolkit directly

MIGRATION GUIDE:
- Replace confirm_custom() calls with confirm()
- Replace HAS_TERMINAL_MENU checks with HAS_PROMPT_TOOLKIT
- Remove style=MENU_STYLE parameters from prompt calls
"""
```

**✅ CORRECT - Comment block format**:

```python
"""
Git-py package for GitHub repository setup and management.

BREAKING CHANGES (v2.0.0):
- confirm_custom() removed → use confirm() instead
- HAS_TERMINAL_MENU removed → use HAS_PROMPT_TOOLKIT instead
- MENU_STYLE removed → no longer needed
- All prompt functions now use prompt_toolkit directly

MIGRATION GUIDE:
- Replace confirm_custom() calls with confirm()
- Replace HAS_TERMINAL_MENU checks with HAS_PROMPT_TOOLKIT
- Remove style=MENU_STYLE parameters from prompt calls
"""
```

**✅ CORRECT - Comment block format**:

```python
"""
[Package/Module Description]

BREAKING CHANGES ([Version]):
- [Old API] removed → use [New API] instead
- [Old Pattern] deprecated → use [New Pattern] instead
- [Old Behavior] changed → [New Behavior] description

MIGRATION GUIDE:
- [Step 1: How to migrate]
- [Step 2: What to replace]
- [Step 3: Additional notes]
"""
```

**❌ INCORRECT - Missing breaking changes documentation**:

```python
"""
Git-py package for GitHub repository setup and management.
"""
# Wrong: No breaking changes documented
```

### **3. :: Complete Codebase Update**

**✅ CORRECT - Update all references in single pass**:

```python
# 1. Search entire codebase for legacy names
# 2. Replace all imports
# 3. Replace all function calls
# 4. Remove legacy definitions
# 5. Update __init__.py exports
# 6. Remove compatibility comments
# All done in single refactoring pass
```

**❌ INCORRECT - Partial updates**:

```python
# Wrong: Updating some files but not others
# File 1: Updated to use confirm()
# File 2: Still uses confirm_custom()  # Inconsistent
```

## **ANTI-PATTERNS**

### **❌ Backward Compatibility Violations**

- ❌ **Keeping Legacy Aliases** - Don't keep function aliases "just in case" after refactoring
- ❌ **Keeping Compatibility Constants** - Don't keep compatibility constants after migration
- ❌ **Partial Updates** - Don't update some files but leave others using legacy code
- ❌ **Missing Breaking Changes Docs** - Don't refactor without documenting breaking changes
- ❌ **No Migration Guide** - Don't remove APIs without providing migration instructions

## **QUALITY GATES**

- [ ] **Complete Removal**: All backward compatibility code removed from codebase
- [ ] **Updated Imports**: All imports use new function/constant names
- [ ] **Updated Calls**: All function calls use new API
- [ ] **Updated Exports**: __init__.py exports updated to remove legacy names
- [ ] **Breaking Changes Documented**: Comment block at top of module/package documents breaking changes
- [ ] **Migration Guide Provided**: Clear migration instructions included in documentation

## **SUCCESS METRICS**

After implementing proper code maintenance:

- ✅ **Clean Codebase** - No legacy code or compatibility shims remaining
- ✅ **Clear Migration Path** - Breaking changes clearly documented with migration guide
- ✅ **Consistent Usage** - All code uses new patterns consistently
- ✅ **No Confusion** - Developers know which functions/constants to use
